## 特征工程
- [1.特征预处理与转换](#1特征预处理与转换)
- [2.特征预提取与衍生](#2特征预提取与衍生)
- [3.特征选择与降维](#3特征选择与降维)
- [4.特征衍生](#4特征衍生)

### 1.特征预处理与转换 
- 特征清洗：错误值，缺失值，异常值
- 特征编码：各类编码，WOE转换，特征分箱 
- 特征转换：形态分布转换，特征归一  

### 2.特征预提取与衍生 
- 业务专家定义
- 工程自动化 
- 模型挖掘学习
- 特殊类型数据 

### 3.特征选择与降维 
- 评价角度：业务角度，数据角度
- 特征选择：Filtering, Embedded, Wrapped (基于学习)
- 特征降维：基于无监督，基于有监督 

### 4.特征衍生
- 特征层级和主键：确定特征对象主键KeyID，例如确定需要衍生的特征是客户级、账户级、卡片级还是交易级 
- 多张表与多级表：多张表是指同一实体层属性特征存储在多个表里，多级表是指实体主表附属多个子表。对于多级表，在特征衍生时需要逐级向上级聚合 

例如，电商购物数据表包括客户层、订单层、订单详情层共三级表，一个客户有多张订单，一个订单有多个商品。在进行特征衍生时，订单详情层就需要聚合到订单层，订单层再进一步聚合到客户层，形成多层级的特征。多张订单形成流水时间序列，对于时间序列特征提取已经有很多成熟的方法  

## Feature Enigneering (FE) 
### Classfying features 
- category features
    - 对于类别型特征，通常采用编码的方式，将其转化为离散数值型
- serial numerical features
- non-serial numerical features  

### Category feature 
类别型变量主要指 职业，血型 等在有限类别内取值的特征。CF通常是字符串，不能直接入模，需要编码转换后才能进入模型。CF的常见分类有：
- 按是否有序：**有序** 和 **无序** 
- 按**类别数量**：**高基类** 和 **低基类**  

常见的编码方式：
- Label Encoder: 简单地赋予不同类别不同的标签
    - 适合于有序类别型特征，在分类任务类别不多的情况下，也可以尝试
    - 但**不建议在高基类特征**上
    - 标签编码后的自然数对于回归任务来说是**线性不可分**   
- Hash Encoder:
- One-Hot Encoder
    - 独热编码可以解决**标签编码对于回归任务中线性不可分的问题**
    - 转换后的变量叫做"哑变量" 
    - 但**处理不好高基数特征**，同时会导致特征稀疏+内存消耗
- 直方图编码
    - 属于目标编码的一种，适用于分类任务
    - 它先将类别属性分类，然后在对应属性下，**统计不同类别标签的样本占比**进行编码
    - 清晰看出特征下不同类别对不同预测标签的贡献度 

- WOE Encoding 
    - 适用于二分类任务，表明**自变量相对于因变量的预测能力** 
    -  

- Target Encoding
    - 适合分类和回归任务，适合**高基类，无序**特征 
    - 计算 先验概率 和 后验概率，用后验概率直接计算 
    - 使用后验概率新增的 c-1 个列之间是线性相关的，会引入**多重共线性**，因此，需要结合先验和后验概率
    - 由于概率是直接使用标签数据计算得到的，所以会引发**过拟合**问题 

- Average Encoding
    - 目标编码的改进版本，有2点改动
        - 权重公式：可自行修改函数内的参数
        - 使用标签导致过拟合问题，引入 K-fold 思路 

- Model Encoding
    - 目前 GBDT 模型中，**只有 LGBM 和 CatBoost 自带类别编码**
    - LGBM 采用的是 GS(Gradient Statistics) 编码, 将**类别特征转为累积值** (一阶偏导数之和/二阶偏导数之和)再进行直方图特征排序。在定义LGB数据集时，指定 categorical_feature.
    - 通常，对 <font color="red"> 无序类别型变量进行模型编码，有序类别型变量直接按顺序标签编码即可 </font> 
    - GS编码也存在2个问题：
        - 耗时长
        - 内存消耗大
    - 针对上述问题：CatBoost 使用了 Ordered TS 编码， 

总结来说，关于类别特征，有以下心得：
- 统计类编码常常不适用于小样本，因为统计意义不明显。
- 当训练集和测试集分布不一致时，统计类编码往往会有预测偏移问题，所以一般会考虑结合交叉验证。
- 编码后特征数变多的编码方法，不适用于高基类的特征，会带来稀疏性和训练成本。
- 没有完美的编码方法，但感觉标签编码、平均编码、WOE编码和模型编码比较常用

    
    


